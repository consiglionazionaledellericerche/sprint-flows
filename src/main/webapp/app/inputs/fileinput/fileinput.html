<fieldset>
    <legend ng-if="legend">{{legend}}
        <span class="glyphicon glyphicon-question-sign" ng-show="item.placeholder" data-toggle="tooltip" data-placement="top" title="{{item.placeholder}}"></span>
        <span class="pull-right" ng-if="multiple">
          <button type="button" class="btn btn-success btn-xs" ng-click="addRow()" ng-disabled="ngModel.length >= max">
            <span class="glyphicon glyphicon-plus"></span>
          </button>
          <button type="button" class="btn btn-danger btn-xs" ng-click="removeRow()" ng-disabled="ngModel.length <= min">
            <span class="glyphicon glyphicon-minus"></span>
          </button>
        </span>
    </legend>

    <div class="well" ng-if="rows.length == 0">
        Usare il bottone
        <button type="button" class="btn btn-success btn-xs" ng-click="addRow()" ng-disabled="ngModel.length >= max">
        <span class="glyphicon glyphicon-plus"></span>
        </button>
        per aggiungere eventuali altri allegati.
    </div>

    <div class="well" ng-repeat="row in rows track by $index" ng-init="rowname = multiple ? name+$index : name; $parent.attachments[rowname] = {}; document = findDocument(rowname);">
        <pre>{{rowname}}{{ $parent.attachments[rowname] | json }}</pre>
        <div class="form-group" ng-if="label === undefined">
            <label>Tipo Documento</label>
            <input type="text" class="form-control" ng-model="$parent.attachments[rowname].label" required>
        </div>
        <div class="form-group" ng-if="label !== undefined" ng-init="$parent.attachments[rowname].label = label">
            <h3>{{label}}</h3>
        </div>

        <div ng-if="metadatiPubblicazione">
            <div class="row form-group">
                <div class="col-md-5">
                    Pubblicazione in URP
                </div>
                <div class="col-md-7">
                    <toggle-switch
                        class="switch-success btn-group btn-group-justified"
                        ng-model="$parent.attachments[rowname].pubblicazioneUrp"
                        ng-init="$parent.attachments[rowname].pubblicazioneUrp = pubblicazioneUrp"
                        off-label="Non pubblicare"
                        on-label="Pubblica"
                        is-disabled="attrs.pubblicazioneUrp !== undefined">
                    </toggle-switch>
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-5">
                    Pubblicazione in Trasparenza
                </div>
                <div class="col-md-7">
                    <toggle-switch
                        class="switch-success btn-group btn-group-justified"
                        ng-model="$parent.attachments[rowname].pubblicazioneTrasparenza"
                        ng-init="$parent.attachments[rowname].pubblicazioneTrasparenza = pubblicazioneTrasparenza"
                        off-label="Non pubblicare"
                        on-label="Pubblica"
                        is-disabled="attrs.pubblicazioneTrasparenza !== undefined">
                    </toggle-switch>
                </div>
            </div>
        </div>

        <div ng-if="metadatiProtocollo">
            <div class="row form-group">
                <div class="col-md-5">
                    Protocollo
                </div>
                <div class="col-md-7">
                    <toggle-switch
                        class="btn-group btn-group-justified"
                        ng-model="$parent.attachments[rowname].protocollo"
                        ng-init="$parent.attachments[rowname].protocollo = protocollo"
                        off-label="Non Protocollato"
                        on-label="Protocollato"
                        is-disabled="attrs.protocollo !== undefined">
                    </toggle-switch>
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-5" ng-if="$parent.attachments[rowname].protocollo">
                    <label>Data protocollo</label>
                    <input type="date" class="form-control" ng-model="$parent.attachments[rowname].dataprotocollo" required>
                </div>
                <div class="col-md-7" ng-if="$parent.attachments[rowname].protocollo">
                    <label>Numero protocollo</label>
                    <input type="text" class="form-control" ng-model="$parent.attachments[rowname].numeroprotocollo" required>
                </div>
            </div>

        </div>


        <a
                href
                ng-click="downloadFile('/api/attachments/task/'+ data.taskId +'/'+ document.name +'/data', document.filename, document.mimetype)" >
            {{document.filename}}
        </a>

        <div class="row form-group">
            <div class="col-md-12">
                <button class="btn btn-sm"
                        ng-class="{'btn-success': $parent.attachments[rowname].name, 'btn-info': !$parent.attachments[rowname].name}"
                        ng-model="$parent.attachments[rowname].data"
                        ngf-select
                        name="$parent.attachments[rowname].data"
                        accept="{{accept}}"
                        ngf-multiple="false"
                        ng-required="cnrRequired" >
                    <span ng-show="!document" class="glyphicon glyphicon-upload"></span>
                    <span ng-show="document.name" class="glyphicon glyphicon-repeat"></span>
                    <span ng-show="!document">Seleziona File</span>
                    <span ng-show="document.name">Aggiorna</span>
                </button>
                <span ng-show="$parent.attachments[rowname].data">
                      {{$parent.attachments[rowname].data.name}}
                      <a href ng-click="$parent.attachments[rowname].data = undefined"><span
                              class="glyphicon glyphicon-remove" title="Rimuovi"></span></a>
                  </span>
            </div>
        </div>

    </div>
</fieldset>

<hr ng-if="multiple">
